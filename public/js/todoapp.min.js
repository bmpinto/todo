jQuery(function(c){var a,d=0;var b={init:function(){var e=c.ajax({type:"POST",url:"controllers/UserController.php",data:{action:"setUpUser"}});e.success(function(f){a=jQuery.parseJSON(f);b.getItems()});this.bindElements();this.bindEvents()},bindElements:function(){this.$newTodo=c(".new-todo");this.$todoList=c(".todo-list");this.$activeItemsNumber=c(".activeItemsNumber");this.$header=c("#header")},bindEvents:function(){this.$newTodo.on("keypress",this.createItem);this.$todoList.on("dblclick",".view-todo",this.editItem);this.$todoList.on("keypress",".edit-todo",this.blurItemOnEnter);this.$todoList.on("blur",".edit-todo",this.updateItem);this.$todoList.on("click",".destroy-todo",this.removeItem);this.$todoList.on("change",".complete-todo",this.completeItem);this.$header.on("click",".activeItems",this.getActiveItems);this.$header.on("click",".doneItems",this.getDoneItems);this.$header.on("click",".allItems",this.getItems)},getItems:function(){var e=0;c(".allItems").addClass("activo").siblings().removeClass("activo");c(".new-todo").fadeIn();c.ajax({type:"POST",beforeSend:function(){c(".allItems").find(".loaderList").toggle();b.$todoList.empty().fadeOut()},url:"controllers/ItemController.php",data:{action:"getItems",user_id:a.fb_id},success:function(f){c(".allItems").find(".loaderList").toggle();b.appendItem(jQuery.parseJSON(f));b.$todoList.fadeIn();e=b.activeCount();b.$activeItemsNumber.html(e);c(".initLoader").fadeOut(function(){c(".settings").fadeIn();c(".items").fadeIn()})}})},getActiveItems:function(){var e=0;c(".activeItems").addClass("activo").siblings().removeClass("activo");c(".new-todo").fadeIn();c.ajax({type:"POST",beforeSend:function(){c(".activeItems").find(".loaderList").toggle();b.$todoList.empty().fadeOut()},url:"controllers/ItemController.php",data:{action:"getActiveItems",user_id:a.fb_id},success:function(f){c(".activeItems").find(".loaderList").toggle();b.appendItem(jQuery.parseJSON(f));b.$todoList.fadeIn();e=b.activeCount();b.$activeItemsNumber.html(e)}})},getDoneItems:function(){c(".doneItems").addClass("activo").siblings().removeClass("activo");c(".new-todo").fadeOut();c.ajax({type:"POST",beforeSend:function(){c(".doneItems").find(".loaderList").toggle();b.$todoList.empty().fadeOut()},url:"controllers/ItemController.php",data:{action:"getDoneItems",user_id:a.fb_id},success:function(e){c(".doneItems").find(".loaderList").toggle();b.appendItem(jQuery.parseJSON(e));b.$todoList.fadeIn();b.$activeItemsNumber.html(d)}})},activeCount:function(){d=0;c.each(this.$todoList.find("li"),function(){if(c(this).attr("data-completed")=="false"){d++}});return d},createItem:function(f){var g=c.trim(c(this).val());if(f.which!==13||!g){return}c.ajax({type:"POST",beforeSend:function(){c(".loaderNewTodo").toggle()},url:"controllers/ItemController.php",data:{action:"addItem",item_title:g,item_status:false,user_id:a.user_id},success:function(e){var h=jQuery.parseJSON(e);var i=[{item_id:h.item_id,item_title:g,item_status:"false"}];c(".loaderNewTodo").toggle();b.appendItem(i);b.$activeItemsNumber.html(++d)}});c(this).val("")},appendItem:function(h){var g=0,f,e;for(g=0;g<h.length;g++){f=this.processView(h[g]);c(".todo-list").prepend('<li data-itemID="'+h[g].item_id+'" data-completed="'+h[g].item_status+'"><input class="edit-todo"><div class="view-todo">'+f+'</div><div class="loaderItems"></div><div class="alerta">Updated</div><div class="triangle"></div></li>')}},processView:function(g){var f='<input type="checkbox" class="complete-todo"><label>'+g.item_title+'</label><p class="destroy-todo">x</p>',e='<input type="checkbox" class="complete-todo" checked="checked"><label class="complete">'+g.item_title+'</label><p class="destroy-todo">x</p>';return g.item_status=="false"?f:e},editItem:function(){var f=c(this).closest("li").addClass("editing").find(".edit-todo");var e=c(this).closest("li").find("label");f.val(e.html()).focus()},blurItemOnEnter:function(f){if(f.which==13){c(this).blur()}},updateItem:function(){var f=c(this).closest("li"),e=f.find("label"),h=e.html(),g=c(this).val();if(h===g){f.removeClass("editing");return}e.html(g);f.removeClass("editing");c.ajax({type:"POST",beforeSend:function(){b.toggleLoader(f)},url:"controllers/ItemController.php",data:{action:"updateItem",item_id:f.attr("data-itemid"),item_title:g,item_status:e.hasClass("complete")},success:function(i){var j=f.find(".alerta");var k=f.find(".triangle");j.animate({opacity:1,left:"-70px"},500);k.animate({opacity:1,left:"-20px"},500);setTimeout(function(){j.animate({opacity:0,left:"-60px"},500);k.animate({opacity:0,left:"-10px"},500)},1000);b.toggleLoader(f)}})},removeItem:function(){var e=c(this).closest("li"),f=e.clone();c.ajax({type:"POST",beforeSend:function(){b.toggleLoader(e)},url:"controllers/ItemController.php",data:{action:"removeItem",item_id:e.attr("data-itemid")},success:function(){b.toggleLoader(e);e.slideUp("fast",function(){c(this).remove()});if(f.attr("data-completed")=="false"){b.$activeItemsNumber.html(--d)}}})},completeItem:function(){var e=c(this).parent().find("label");c(this).is(":checked")?e.addClass("complete"):e.removeClass("complete");b.updateComplete(c(this))},updateComplete:function(g){var h=this,i=g.closest("li"),f=i.find("label"),e=f.hasClass("complete");e?i.attr("data-completed","true"):i.attr("data-completed","false");c.ajax({type:"POST",beforeSend:function(){h.toggleLoader(i)},url:"controllers/ItemController.php",data:{action:"updateItem",item_id:i.attr("data-itemid"),item_title:f.html(),item_status:e},success:function(j){var k=i.find(".alerta");var l=i.find(".triangle");k.animate({opacity:1,left:"-70px"},500);l.animate({opacity:1,left:"-20px"},500);setTimeout(function(){k.animate({opacity:0,left:"-60px"},500);l.animate({opacity:0,left:"-10px"},500)},1000);setTimeout(function(){if(c(".activeItems").hasClass("activo")){i.slideUp("fast",function(){c(this).remove()})}if(c(".doneItems").hasClass("activo")){i.slideUp("fast",function(){c(this).remove()})}},1500);h.toggleLoader(i);i.attr("data-completed")=="false"?h.$activeItemsNumber.html(++d):h.$activeItemsNumber.html(--d)}})},toggleLoader:function(e){e.find(".loaderItems").toggle()}};b.init();c(".logout").hover(function(){c(".logoutHelper").animate({opacity:1,left:"30px"})},function(){c(".logoutHelper").animate({opacity:0,left:"25px"})});c(".logoutBtn").on("click",function(g){g.preventDefault();var f=c(this).attr("href");c.ajax({url:"public/logout.php",success:function(e){window.location.href=f}})});c(".logoutHelper").on("click",function(g){g.preventDefault();var f=c(this).attr("href");c.ajax({url:"public/logout.php",success:function(e){window.location.href=f}})})});